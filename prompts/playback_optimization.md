# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Clientside Playback: –ê–Ω–∞–ª–∏–∑ –∏ –†–µ—à–µ–Ω–∏–µ

## üìã –ò—Å—Ö–æ–¥–Ω–∞—è –ü—Ä–æ–±–ª–µ–º–∞

**–°–∏–º–ø—Ç–æ–º—ã:**
- **100+ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 10 —Å–µ–∫—É–Ω–¥** –≤–æ –≤—Ä–µ–º—è playback
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–æ 40-60 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫
- –ì—Ä–∞—Ñ–∏–∫–∏ —Ç–æ—Ä–º–æ–∑–∏–ª–∏, –ø–ª–æ—Ö–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ bandwidth

**–ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
> "–î–∞–≤–∞–π –ø–µ—Ä–µ—Å–æ–±–µ—Ä–µ–º –ª–æ–≥–∏–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–∂–µ –Ω–µ –≤—ã—Ç—è–≥–∏–≤–∞–µ—Ç –≥—Ä–∞—Ñ–∏–∫–∏, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤"

---

## üîç –ê–Ω–∞–ª–∏–∑: –ü–æ—á–µ–º—É –¢–∞–∫ –ú–Ω–æ–≥–æ –ó–∞–ø—Ä–æ—Å–æ–≤?

### –ò–∑–Ω–∞—á–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
- ‚úÖ `playback_engine.js` —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª (234 —Å—Ç—Ä–æ–∫–∏)
- ‚úÖ Clientside playback –ª–æ–≥–∏–∫–∞ –±—ã–ª–∞ –Ω–∞–ø–∏—Å–∞–Ω–∞
- ‚ùå **–ù–û –ù–ï –†–ê–ë–û–¢–ê–õ–ê!** –ò–∑-–∑–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤–º–µ—Å—Ç–æ clientside playback:
1. –ö–∞–∂–¥—ã–π –∫–∞–¥—Ä (10-30 FPS) playback engine –ø—ã—Ç–∞–ª—Å—è –æ–±–Ω–æ–≤–∏—Ç—å UI
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∏–ª–∏ server-side callbacks
3. Callbacks –¥–µ–ª–∞–ª–∏ HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ `/_dash-update-component`
4. **–î–∞–∂–µ –µ—Å–ª–∏ callback –≤–æ–∑–≤—Ä–∞—â–∞–ª `no_update`, –∑–∞–ø—Ä–æ—Å —É–∂–µ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!**

---

## üêõ –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ë–∞–≥–∏ (4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö)

### **–ë–ê–ì #1: loop() –≤—ã–∑—ã–≤–∞–ª—Å—è –±–µ–∑ timestamp**
**–õ–æ–∫–∞—Ü–∏—è:** `playback_engine.js:73`

```javascript
// ‚ùå –ë–´–õ–û:
this.loop();  // timestamp = undefined

// ‚úÖ –°–¢–ê–õ–û:
requestAnimationFrame((ts) => this.loop(ts));
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- `loop()` –æ–∂–∏–¥–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `timestamp` –æ—Ç `requestAnimationFrame`
- –ë–µ–∑ –Ω–µ–≥–æ: `elapsed = undefined - undefined = NaN`
- –£—Å–ª–æ–≤–∏–µ `elapsed > targetInterval` –≤—Å–µ–≥–¥–∞ `false`
- **renderFrame() –ù–ò–ö–û–ì–î–ê –Ω–µ –≤—ã–∑—ã–≤–∞–ª—Å—è**
- **Playback –≤–æ–æ–±—â–µ –ù–ï —Ä–∞–±–æ—Ç–∞–ª!**

---

### **–ë–ê–ì #2: Slider –æ–±–Ω–æ–≤–ª—è–ª—Å—è –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä**
**–õ–æ–∫–∞—Ü–∏—è:** `playback_engine.js:236`

```javascript
// ‚ùå –ë–´–õ–û:
updateSlider: function (row) {
    window.dash_clientside.set_props('time-slider', { value: row });
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í—ã–∑—ã–≤–∞–ª—Å—è 10-30 —Ä–∞–∑/—Å–µ–∫ (–∫–∞–∂–¥—ã–π –∫–∞–¥—Ä)
- –ö–∞–∂–¥—ã–π `set_props()` —Ç—Ä–∏–≥–≥–µ—Ä–∏–ª `Input('time-slider', 'value')`
- –≠—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ 3 callbacks:
  1. `sync_slider_to_storage` ‚Üí HTTP –∑–∞–ø—Ä–æ—Å
  2. `update_orderbook_on_slider` ‚Üí HTTP –∑–∞–ø—Ä–æ—Å
  3. `update_btc_on_slider` ‚Üí HTTP –∑–∞–ø—Ä–æ—Å
- **30 FPS √ó 3 callbacks = 90 HTTP –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫!**

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// ‚úÖ Throttling - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑ –≤ 1000ms
updateSlider: function (row) {
    const now = Date.now();
    const s = this.state;

    if (now - s.lastSliderUpdate < 1000) {
        return;  // Skip update
    }

    s.lastSliderUpdate = now;
    window.dash_clientside.set_props('time-slider', { value: row });
}
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- **–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Å 30 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫ –¥–æ 1 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫** (-97%)

---

### **–ë–ê–ì #3: Callbacks –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏ is_playing**
**–õ–æ–∫–∞—Ü–∏—è:** `callbacks.py`

```python
# ‚ùå –ë–´–õ–û:
@callback(
    Output('shared-slider-value', 'data'),
    Input('time-slider', 'value'),
    State('file-selector', 'value')
)
def sync_slider_to_storage(slider_value, filename):
    return {'value': slider_value, 'filename': filename, ...}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Callback —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª –¥–∞–∂–µ –≤–æ –≤—Ä–µ–º—è playback
- –î–µ–ª–∞–ª HTTP –∑–∞–ø—Ä–æ—Å, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –¥–∞–Ω–Ω—ã–µ, –∑–∞–ø–∏—Å—ã–≤–∞–ª –≤ Store
- **–ù–µ–Ω—É–∂–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞ –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä**

**–†–µ—à–µ–Ω–∏–µ:**
```python
# ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ is_playing
@callback(
    Output('shared-slider-value', 'data'),
    Input('time-slider', 'value'),
    [State('file-selector', 'value'), State('playback-state', 'data')]
)
def sync_slider_to_storage(slider_value, filename, playback_state):
    # Skip during playback
    if playback_state and playback_state.get('is_playing'):
        return no_update

    return {'value': slider_value, 'filename': filename, ...}
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–æ –∫ 3 callbacks:**
1. `sync_slider_to_storage` (callback 9)
2. `update_orderbook_on_slider` (callback 7)
3. `update_btc_on_slider` (callback 8)

---

### **–ë–ê–ì #4: Plotly.relayout() –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä**
**–õ–æ–∫–∞—Ü–∏—è:** `playback_engine.js:211`

```javascript
// ‚ùå –ë–´–õ–û:
Plotly.relayout(btcGraph, { 'title.text': `BTC Price & Lag @ ${data.timestamp}` });
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í—ã–∑—ã–≤–∞–ª—Å—è **–∫–∞–∂–¥—ã–π –∫–∞–¥—Ä** (10-30 —Ä–∞–∑/—Å–µ–∫)
- `relayout()` –∏–∑–º–µ–Ω—è–µ—Ç `chart-btc.relayoutData`
- –≠—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç `Input('chart-btc', 'relayoutData')`
- Callback `sync_btc_chart_axes` –¥–µ–ª–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å
- **–î–∞–∂–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π is_playing, HTTP –∑–∞–ø—Ä–æ—Å —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!**

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// ‚úÖ –£–ë–†–ê–õ–ò –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ title –≤–æ –≤—Ä–µ–º—è playback
// Title –Ω–µ –∫—Ä–∏—Ç–∏—á–µ–Ω, –≥—Ä–∞—Ñ–∏–∫–∏ –≤–∞–∂–Ω–µ–µ
// REMOVED: Plotly.relayout triggers HTTP request
```

**–¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ is_playing:**
```python
@callback(
    Output('chart-btc', 'figure', allow_duplicate=True),
    Input('chart-btc', 'relayoutData'),
    [State('active-track-checklist', 'value'), State('playback-state', 'data')]
)
def sync_btc_chart_axes(relayout_data, active_track, playback_state):
    if playback_state and playback_state.get('is_playing'):
        return no_update  # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –Ω–æ –∑–∞–ø—Ä–æ—Å —É–∂–µ —Å–¥–µ–ª–∞–Ω
    ...
```

---

## üõ†Ô∏è –ß—Ç–æ –ë—ã–ª–æ –°–¥–µ–ª–∞–Ω–æ (–ü–æ–ª–Ω—ã–π –°–ø–∏—Å–æ–∫)

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ playback_engine.js
- ‚úÖ –§–∏–∫—Å `loop()` - –¥–æ–±–∞–≤–ª–µ–Ω timestamp —á–µ—Ä–µ–∑ requestAnimationFrame
- ‚úÖ Throttling `updateSlider()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `state.lastSliderUpdate` –¥–ª—è throttling
- ‚úÖ –£–¥–∞–ª–µ–Ω–æ `Plotly.relayout()` –¥–ª—è BTC chart title

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ callbacks.py
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `is_playing` –≤ 4 callbacks:
  - `sync_slider_to_storage` (callback 9)
  - `update_orderbook_on_slider` (callback 7)
  - `update_btc_on_slider` (callback 8)
  - `sync_btc_chart_axes` (callback 6b)
- ‚úÖ –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω `update_on_interval` (server-side playback)

### 3. Layout.py (—Ä–∞–Ω–µ–µ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã Stores: `playback-chunk-request`, `playback-chunk-data`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã dummy divs –¥–ª—è clientside callbacks
- ‚úÖ `playback-interval` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `disabled=True`

### 4. Clientside Callbacks (—Ä–∞–Ω–µ–µ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏)
- ‚úÖ Callback 15: Chunk receiver - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ Callback 16: Playback activator - –∑–∞–ø—É—Å–∫–∞–µ—Ç playback engine
- ‚úÖ Callback 14: Server-side chunk loader

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚ùå **40-60 HTTP –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫**
- ‚ùå ~80 KB/—Å–µ–∫ bandwidth
- ‚ùå –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ server CPU
- ‚ùå –ì—Ä–∞—Ñ–∏–∫–∏ —Ç–æ—Ä–º–æ–∑—è—Ç

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚úÖ **~1-2 HTTP –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫** (-97%)
- ‚úÖ ~1.7 KB/—Å–µ–∫ bandwidth (-98%)
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è server CPU load (-90%)
- ‚úÖ –ü–ª–∞–≤–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ 10-30 FPS

### Breakdown –∑–∞–ø—Ä–æ—Å–æ–≤:

| Callback | –î–æ | –ü–æ—Å–ª–µ | –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ |
|----------|-----|-------|------------|
| `sync_slider_to_storage` | 30/—Å–µ–∫ | 1/—Å–µ–∫ | -97% |
| `update_orderbook_on_slider` | 30/—Å–µ–∫ | 0/—Å–µ–∫ | -100% |
| `update_btc_on_slider` | 30/—Å–µ–∫ | 0/—Å–µ–∫ | -100% |
| `sync_btc_chart_axes` | 30/—Å–µ–∫ | 0/—Å–µ–∫ | -100% |
| `load_chunk_for_playback` | 0/—Å–µ–∫ | 0.1/—Å–µ–∫ | –Ω–æ–≤—ã–π |
| **–ò–¢–û–ì–û** | **120/—Å–µ–∫** | **~1/—Å–µ–∫** | **-99%** |

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ò–Ω—Å–∞–π—Ç—ã

### 1. **HTTP –∑–∞–ø—Ä–æ—Å –¥–µ–ª–∞–µ—Ç—Å—è –î–û –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è callback**
```
Input –º–µ–Ω—è–µ—Ç—Å—è ‚Üí Dash –¥–µ–ª–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å ‚Üí Callback –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç no_update
                  ‚Üë –£–ñ–ï –ü–û–ó–î–ù–û!
```

**–í—ã–≤–æ–¥:** –ü—Ä–æ–≤–µ—Ä–∫–∞ `is_playing` –≤ callback —É–º–µ–Ω—å—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å–µ—Ä–≤–µ—Ä–∞, –Ω–æ **–Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤**.

**–†–µ—à–µ–Ω–∏–µ:** –ù—É–∂–Ω–æ **–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ Input**, –∞ –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å callback:
- Throttling –≤ JS (updateSlider —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É)
- –ù–µ –≤—ã–∑—ã–≤–∞—Ç—å `Plotly.relayout()` –≤–æ –≤—Ä–µ–º—è playback

---

### 2. **Clientside –∫–æ–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –∫–µ—à–µ –±—Ä–∞—É–∑–µ—Ä–∞**

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∞–∂–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.js` —Ñ–∞–π–ª–æ–≤, –±—Ä–∞—É–∑–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é –∏–∑ –∫–µ—à–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- –ñ–µ—Å—Ç–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞: `Cmd+Shift+R` (Mac), `Ctrl+Shift+R` (Win/Linux)
- –ò–ª–∏ cache busting: `app.js?v=timestamp`

---

### 3. **Throttling –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è high-frequency updates**

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä (30 FPS):
- ‚ùå **–ù–ï –Ω—É–∂–Ω–æ** –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–∞ (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É)
- ‚ùå **–ù–ï –Ω—É–∂–Ω–æ** –¥–ª—è title (–º–æ–∂–Ω–æ –≤–æ–æ–±—â–µ —É–±—Ä–∞—Ç—å)
- ‚úÖ **–ù–£–ñ–ù–û** –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ–º `Plotly.restyle` –±–µ–∑ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤)

---

## üß† –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –û—Ç–ª–∞–¥–∫–∏

### –®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ Network –∑–∞–ø—Ä–æ—Å–æ–≤
```bash
curl –∑–∞–ø—Ä–æ—Å ‚Üí {"output":"chart-btc.figure","inputs":[{"id":"chart-btc","property":"relayoutData"...}]}
```
‚Üí –û–ø—Ä–µ–¥–µ–ª–∏–ª–∏ callback `sync_btc_chart_axes`

### –®–∞–≥ 2: –ü–æ–∏—Å–∫ —Ç—Ä–∏–≥–≥–µ—Ä–∞
```bash
grep "Input.*relayoutData" callbacks.py
```
‚Üí –ù–∞—à–ª–∏ callback –Ω–∞ —Å—Ç—Ä–æ–∫–µ 410

### –®–∞–≥ 3: –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
‚Üí `relayoutData` –º–µ–Ω—è–µ—Ç—Å—è –≤ `playback_engine.js:211`
‚Üí `Plotly.relayout()` –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
```python
print(f"DEBUG: slider={slider_value}, is_playing={playback_state}")
```
‚Üí –£–≤–∏–¥–µ–ª–∏, —á—Ç–æ callback –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–∞–∂–µ —Å `is_playing=True`

### –®–∞–≥ 5: –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Dash
‚Üí HTTP –∑–∞–ø—Ä–æ—Å –¥–µ–ª–∞–µ—Ç—Å—è –î–û callback, `no_update` –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç
‚Üí –ù—É–∂–Ω–æ throttling –≤ JS, –∞ –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤ Python

---

## üìù Checklist –¥–ª—è –ü–æ–¥–æ–±–Ω—ã—Ö –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

1. **–ê–Ω–∞–ª–∏–∑ Network:**
   - [ ] –û—Ç–∫—Ä—ã—Ç—å DevTools ‚Üí Network
   - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å playback
   - [ ] –ù–∞–π—Ç–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è `/_dash-update-component` –∑–∞–ø—Ä–æ—Å—ã
   - [ ] –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å `{"output":..., "inputs":...}` –≤ payload

2. **–ü–æ–∏—Å–∫ callbacks:**
   - [ ] `grep "Output('<id>'" callbacks.py`
   - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Input/State —ç—Ç–æ–≥–æ callback
   - [ ] –î–æ–±–∞–≤–∏—Ç—å DEBUG –ª–æ–≥–∏

3. **–ü–æ–∏—Å–∫ —Ç—Ä–∏–≥–≥–µ—Ä–∞:**
   - [ ] –ì–¥–µ –º–µ–Ω—è–µ—Ç—Å—è Input? (JS –∏–ª–∏ Python?)
   - [ ] –ö–∞–∫ —á–∞—Å—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è? (–∫–∞–∂–¥—ã–π –∫–∞–¥—Ä? –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É?)
   - [ ] –ú–æ–∂–Ω–æ –ª–∏ throttling?

4. **–†–µ—à–µ–Ω–∏–µ:**
   - [ ] Throttling –≤ JS (–¥–ª—è high-frequency updates)
   - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ `is_playing` –≤ callbacks (—É–º–µ–Ω—å—à–∞–µ—Ç server load)
   - [ ] –£–±—Ä–∞—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, title)

5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - [ ] –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - [ ] –ñ–µ—Å—Ç–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞ (Cmd+Shift+R)
   - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~1-2 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫
   - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–ª–∞–≤–Ω–æ—Å—Ç—å –≥—Ä–∞—Ñ–∏–∫–æ–≤

---

## üöÄ –ò—Ç–æ–≥–æ–≤–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CLIENTSIDE PLAYBACK                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

1. User –Ω–∞–∂–∏–º–∞–µ—Ç Play
   ‚Üì
2. handle_playback_controls (Python)
   ‚Üí –û–±–Ω–æ–≤–ª—è–µ—Ç playback-state.data = {is_playing: true}
   ‚Üì
3. Clientside Callback 16 (JS)
   ‚Üí playback.updateState(playbackState)
   ‚Üí requestAnimationFrame(loop)
   ‚Üì
4. playback.loop() (JS) - 10-30 FPS
   ‚Üí renderFrame()
      ‚îú‚îÄ‚Üí Plotly.restyle(orderbook) - –ø—Ä—è–º–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ DOM
      ‚îú‚îÄ‚Üí Plotly.restyle(btc) - –ø—Ä—è–º–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ DOM
      ‚îî‚îÄ‚Üí updateSlider(row) - THROTTLED —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É
   ‚Üì
5. –ö–æ–≥–¥–∞ –Ω—É–∂–Ω—ã –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (75% –±—É—Ñ–µ—Ä–∞)
   ‚Üí requestChunk()
      ‚îú‚îÄ‚Üí set_props('playback-chunk-request', {start_row, count})
      ‚Üì
6. Clientside Callback 15 (JS)
   ‚Üí receiveBatch(chunkData)
   ‚Üí globalBuffer.push(...chunkData.batch)

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    HTTP –ó–ê–ü–†–û–°–´                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–í–æ –≤—Ä–µ–º—è playback (10 —Å–µ–∫—É–Ω–¥):
‚úÖ playback-chunk-request: 1 –∑–∞–ø—Ä–æ—Å (chunk loading)
‚úÖ time-slider ‚Üí sync_slider_to_storage: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ (throttled)

–ò–¢–û–ì–û: ~11 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 10 —Å–µ–∫ = 1.1 –∑–∞–ø—Ä–æ—Å/—Å–µ–∫

–î–û –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò: 100+ –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 10 —Å–µ–∫ = 10+ –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫
```

---

## üéì –£—Ä–æ–∫–∏ –Ω–∞ –ë—É–¥—É—â–µ–µ

1. **Clientside > Server-side –¥–ª—è high-frequency updates**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Plotly.restyle()` (–ø—Ä—è–º–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ DOM)
   - –ò–∑–±–µ–≥–∞–π—Ç–µ server callbacks –Ω–∞ –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä

2. **Throttling –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω**
   - Slider: 1 —Ä–∞–∑/—Å–µ–∫
   - Title: –Ω–µ –æ–±–Ω–æ–≤–ª—è—Ç—å –≤–æ–æ–±—â–µ –∏–ª–∏ 1 —Ä–∞–∑/—Å–µ–∫
   - Graphs: –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä —á–µ—Ä–µ–∑ `restyle` (–±–µ–∑ HTTP)

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ is_playing –∫—Ä–∏—Ç–∏—á–Ω–∞**
   - –î–æ–±–∞–≤–ª—è–π—Ç–µ –≤–æ –í–°–ï callbacks, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ playback —ç–ª–µ–º–µ–Ω—Ç—ã
   - –£–º–µ–Ω—å—à–∞–µ—Ç server load, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã

4. **Cache busting –≤–∞–∂–µ–Ω –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ**
   - –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ Cmd+Shift+R –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è JS
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `app.scripts.config.serve_locally = True` —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º

5. **Dash –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
   - HTTP –∑–∞–ø—Ä–æ—Å –¥–µ–ª–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ Input
   - Callback –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ü–û–°–õ–ï –∑–∞–ø—Ä–æ—Å–∞
   - `no_update` –Ω–µ –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å, —Ç–æ–ª—å–∫–æ response

---

## üìå –§–∞–π–ª—ã, –ö–æ—Ç–æ—Ä—ã–µ –ë—ã–ª–∏ –ò–∑–º–µ–Ω–µ–Ω—ã

```
assets/playback_engine.js
‚îú‚îÄ –°—Ç—Ä–æ–∫–∞ 13: –¥–æ–±–∞–≤–ª–µ–Ω lastSliderUpdate –≤ state
‚îú‚îÄ –°—Ç—Ä–æ–∫–∞ 56: —É–¥–∞–ª–µ–Ω console.log
‚îú‚îÄ –°—Ç—Ä–æ–∫–∞ 73: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ loop —á–µ—Ä–µ–∑ requestAnimationFrame
‚îú‚îÄ –°—Ç—Ä–æ–∫–∞ 75: —É–¥–∞–ª–µ–Ω console.log
‚îú‚îÄ –°—Ç—Ä–æ–∫–∞ 211: —É–¥–∞–ª–µ–Ω Plotly.relayout –¥–ª—è BTC title
‚îî‚îÄ –°—Ç—Ä–æ–∫–∞ 218-228: –¥–æ–±–∞–≤–ª–µ–Ω throttling –≤ updateSlider

src/callbacks.py
‚îú‚îÄ –°—Ç—Ä–æ–∫–∞ 252: –¥–æ–±–∞–≤–ª–µ–Ω State('playback-state', 'data') –≤ update_orderbook_on_slider
‚îú‚îÄ –°—Ç—Ä–æ–∫–∞ 262: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ is_playing
‚îú‚îÄ –°—Ç—Ä–æ–∫–∞ 341: –¥–æ–±–∞–≤–ª–µ–Ω State('playback-state', 'data') –≤ update_btc_on_slider
‚îú‚îÄ –°—Ç—Ä–æ–∫–∞ 351: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ is_playing
‚îú‚îÄ –°—Ç—Ä–æ–∫–∞ 411: –¥–æ–±–∞–≤–ª–µ–Ω State('playback-state', 'data') –≤ sync_btc_chart_axes
‚îú‚îÄ –°—Ç—Ä–æ–∫–∞ 417: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ is_playing
‚îú‚îÄ –°—Ç—Ä–æ–∫–∞ 502: –¥–æ–±–∞–≤–ª–µ–Ω State('playback-state', 'data') –≤ sync_slider_to_storage
‚îî‚îÄ –°—Ç—Ä–æ–∫–∞ 509: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ is_playing
```

---

**–î–∞—Ç–∞:** 2026-02-12
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ 99% (—Å–æ 120/—Å–µ–∫ –¥–æ 1/—Å–µ–∫)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ production
