# Dashboard Review: Детальное объяснение переменных терминала

## Обзор структуры дашборда

Дашборд отображает real-time данные для торговли на Polymarket BTC 15-minute UP/DOWN рынках. Данные поступают из трёх источников: Chainlink (оракул), Binance (биржа), Polymarket (стаканы заявок).

---

## Строка 1: Header

```
[HH:MM:SS] Dashboard │ ENDS: MM:SS (XXXs) │ PM_UP: X.XX │ PM_DN: X.XX
```

### `ts` — Текущее время
- **Источник**: `time.strftime("%H:%M:%S")`
- **Формат**: HH:MM:SS (локальное время)
- **Назначение**: Синхронизация с рыночным временем

### `market_time_left` / `market_seconds_left` — Время до конца рынка
- **Источник**: `time_to_market_end()` (строки 599-610)
- **Формат**: `MM:SS` и целое число секунд
- **Расчёт**:
  ```python
  current_slot_end = (current_time // 900) * 900 + 900
  time_left = current_slot_end - current_time
  ```
- **Торговый контекст**:
  - **> 600s (10+ мин)**: Ранняя фаза — цены волатильны, можно занять позицию
  - **300-600s (5-10 мин)**: Средняя фаза — тренд формируется
  - **< 120s (< 2 мин)**: Финальная фаза — цены сходятся к 0 или 1, спреды расширяются
  - **< 30s**: Критическая зона — только экстренный выход, ликвидность минимальна

### `up_str` / `down_str` (PM_UP / PM_DN) — Лучшие цены Ask
- **Источник**: `state_pm.up_best[0]`, `state_pm.down_best[0]`
- **Формат**: Цена в диапазоне 0.00-1.00
- **Что означает**: Минимальная цена, по которой можно КУПИТЬ контракт UP или DOWN
- **Торговый контекст**:
  - **UP + DOWN ≈ 1.00**: Рынок эффективен
  - **UP + DOWN < 0.98**: Арбитражная возможность (редко)
  - **UP + DOWN > 1.02**: Повышенные спреды, низкая ликвидность
- **Пример интерпретации**:
  - `PM_UP: 0.55` → Рынок оценивает вероятность роста BTC в 55%
  - `PM_DN: 0.47` → Вероятность падения 47%, сумма 1.02 (спред 2%)

---

## Строка RETURNS

```
RETURNS   │ Ret1s×100: ±X.XX │ Ret5s×100: ±X.XX
```

### `bn_ret1s_str` (Ret1s×100) — 1-секундная доходность Binance
- **Источник**: `calculate_return(state_bn.price_history, 1.0)` × 100
- **Единица**: Базисные пункты (0.01 = 1 bp = 0.01%)
- **Расчёт**: `(price_now - price_1s_ago) / price_1s_ago × 100`
- **Торговый контекст**:
  - **|Ret1s| < 0.01**: Спокойный рынок, можно ставить лимитные ордера
  - **|Ret1s| > 0.05**: Импульс, возможен пробой
  - **Ret1s > 0.10**: Сильный импульс вверх — сигнал для UP
  - **Ret1s < -0.10**: Сильный импульс вниз — сигнал для DOWN
- **Практика**: Используйте для детекции микро-импульсов. При |Ret1s| > 0.05 в сочетании с Volume Spike — высокая вероятность продолжения движения.

### `bn_ret5s_str` (Ret5s×100) — 5-секундная доходность Binance
- **Источник**: `calculate_return(state_bn.price_history, 5.0)` × 100
- **Единица**: Базисные пункты
- **Торговый контекст**:
  - Более сглаженный показатель, фильтрует шум
  - **Ret5s и Ret1s одного знака**: Подтверждённый тренд
  - **Ret5s и Ret1s разных знаков**: Разворот или консолидация
  - **|Ret5s| > 0.20**: Значимое движение за 5 секунд
- **Практика**: Сравнивайте Ret1s и Ret5s. Если Ret1s резко вырос, а Ret5s ещё низкий — возможно начало импульса.

---

## Строка VOLATILITY

```
VOLATILITY│ ATR5s: X.XX │ ATR30s: X.XX │ RVol30s: X.XXXX
```

### `bn_atr5s_str` (ATR5s) — Average True Range за 5 секунд
- **Источник**: `calculate_atr_full(state_bn.kline_history, 5.0)`
- **Единица**: USD (абсолютное значение)
- **Расчёт**: Среднее True Range за последние 5 секунд
  ```python
  TR = max(high - low, |high - prev_close|, |low - prev_close|)
  ATR = mean(TR)
  ```
- **Торговый контекст**:
  - **ATR5s < 5**: Низкая волатильность, спокойный рынок
  - **ATR5s 5-15**: Нормальная волатильность
  - **ATR5s > 20**: Высокая волатильность, осторожность с размером позиции
- **Практика**: Используйте для установки стоп-лоссов. При ATR5s = 10, логичный стоп = 2-3 ATR = $20-30.

### `bn_atr30s_str` (ATR30s) — Average True Range за 30 секунд
- **Источник**: `calculate_atr_full(state_bn.kline_history, 30.0)`
- **Единица**: USD
- **Торговый контекст**:
  - Более стабильный показатель волатильности
  - **ATR30s >> ATR5s**: Волатильность снижается (затишье)
  - **ATR30s << ATR5s**: Волатильность растёт (начало движения)
  - Соотношение ATR5s/ATR30s показывает тренд волатильности
- **Практика**: Если ATR5s > 2×ATR30s — рынок "проснулся", ожидайте продолжения движения.

### `bn_rvol30s_str` (RVol30s) — Realized Volatility за 30 секунд
- **Источник**: `calculate_rvol(state_bn.price_history, 30.0)`
- **Единица**: % (стандартное отклонение log-returns)
- **Расчёт**:
  ```python
  log_returns = [ln(price[i] / price[i-1]) for i in range(1, len(prices))]
  rvol = std(log_returns) × 100
  ```
- **Торговый контекст**:
  - **RVol < 0.01%**: Очень низкая волатильность
  - **RVol 0.01-0.05%**: Нормальная
  - **RVol > 0.10%**: Высокая, возможен пробой уровня
- **Практика**: RVol лучше ATR для сравнения разных таймфреймов и активов. Используйте для оценки "режима рынка".

---

## Строка VOLUME

```
VOLUME    │ V1s: XXXXX │ V5s: XXXXX │ VolMA30s: XXXXX │ Spike: X.XX
```

### `bn_v1` (V1s) — Объём за последнюю 1 секунду
- **Источник**: `state_bn.vol_1s` (поле `q` из Binance kline)
- **Единица**: USDT (quote volume)
- **Торговый контекст**:
  - Типичный V1s для BTCUSDT: $50,000-$500,000
  - **V1s < $50,000**: Низкая активность
  - **V1s > $500,000**: Повышенная активность
  - **V1s > $1,000,000**: Крупный игрок или новость
- **Практика**: Резкий скачок V1s без движения цены — накопление/распределение. Скачок V1s + движение цены — импульс.

### `bn_v5` (V5s) — Объём за последние 5 секунд
- **Источник**: `sum(state_bn._last_five)` (скользящая сумма)
- **Единица**: USDT
- **Торговый контекст**:
  - Сглаженный показатель активности
  - V5s/5 даёт средний объём в секунду
- **Практика**: Сравнивайте V5s/5 с V1s. Если V1s >> V5s/5 — текущая секунда аномально активна.

### `bn_volma30s_str` (VolMA30s) — Скользящее среднее объёма за 30 секунд
- **Источник**: `calculate_volma(state_bn.volume_history, 30.0)`
- **Единица**: USDT (средний объём в секунду)
- **Расчёт**: `mean(volumes за 30s)`
- **Торговый контекст**:
  - Базовая линия для сравнения текущего объёма
  - Показывает "нормальный" уровень активности
- **Практика**: Используйте как benchmark. VolMA30s × 3 = порог для значимого всплеска.

### `bn_volume_spike_str` (Spike) — Коэффициент всплеска объёма
- **Источник**: `calculate_volume_spike(bn_v1, bn_volma30s)`
- **Единица**: Безразмерный коэффициент
- **Расчёт**: `V1s / VolMA30s`
- **Торговый контекст**:
  - **Spike < 0.5**: Затишье, ниже среднего
  - **Spike 0.5-2.0**: Нормальная активность
  - **Spike 2.0-3.0**: Повышенная активность
  - **Spike > 3.0**: Значительный всплеск — СИГНАЛ
  - **Spike > 5.0**: Экстремальный всплеск — новость или крупный игрок
- **Практика**:
  - Spike > 3 + Ret1s > 0.05 → Сильный сигнал UP
  - Spike > 3 + Ret1s < -0.05 → Сильный сигнал DOWN
  - Spike > 3 без движения цены → Возможная ловушка/накопление

---

## Строка VWAP

```
VWAP      │ VWAP30s: XXXXX │ P/VWAP5s: ±X.XX │ P/VWAP30s: ±X.XX
```

### `bn_vwap30s_str` (VWAP30s) — Volume Weighted Average Price за 30 секунд
- **Источник**: `calculate_vwap(state_bn.price_volume_history, 30.0)`
- **Единица**: USD (цена BTC)
- **Расчёт**:
  ```python
  VWAP = Σ(price × volume) / Σ(volume)
  ```
- **Торговый контекст**:
  - Средневзвешенная цена за последние 30 секунд
  - Показывает "справедливую" цену с учётом объёмов
  - Цена выше VWAP → покупательское давление
  - Цена ниже VWAP → давление продавцов
- **Практика**: VWAP — ключевой уровень для крупных игроков. Пробой VWAP с объёмом — сильный сигнал.

### `bn_vwap_dev5s_str` (P/VWAP5s) — Отклонение цены от VWAP за 5 секунд
- **Источник**: `calculate_vwap_deviation(bn_price, bn_vwap5s)`
- **Единица**: % (отклонение)
- **Расчёт**: `((current_price / VWAP5s) - 1) × 100`
- **Торговый контекст**:
  - **P/VWAP5s > 0**: Цена выше краткосрочного VWAP — бычий сигнал
  - **P/VWAP5s < 0**: Цена ниже — медвежий сигнал
  - **|P/VWAP5s| > 0.05%**: Значимое отклонение
- **Практика**: Быстрый индикатор направления. Если P/VWAP5s растёт — momentum вверх.

### `bn_vwap_dev30s_str` (P/VWAP30s) — Отклонение цены от VWAP за 30 секунд
- **Источник**: `calculate_vwap_deviation(bn_price, bn_vwap30s)`
- **Единица**: %
- **Торговый контекст**:
  - Более стабильный показатель
  - **P/VWAP5s и P/VWAP30s > 0**: Подтверждённый бычий тренд
  - **P/VWAP5s > 0, P/VWAP30s < 0**: Возможный разворот вверх
  - **P/VWAP5s < 0, P/VWAP30s > 0**: Возможный разворот вниз
- **Практика**: Дивергенция между P/VWAP5s и P/VWAP30s сигнализирует о возможном развороте.

---

## Секция ORDERBOOK ANALYTICS

### Строка IMBALANCE

```
IMBALANCE │ UP: ±X.XXX │ DN: ±X.XXX  (>0=bid pressure, <0=ask pressure)
```

### `up_imb_str` / `down_imb_str` — Дисбаланс стакана
- **Источник**: `calculate_imbalance(bids, asks, 5)`
- **Единица**: Безразмерный, диапазон [-1, +1]
- **Расчёт**:
  ```python
  imbalance = (sum_bid_size - sum_ask_size) / (sum_bid_size + sum_ask_size)
  ```
- **Торговый контекст**:
  - **Imbalance > +0.3**: Сильное давление покупателей (bid pressure)
  - **Imbalance < -0.3**: Сильное давление продавцов (ask pressure)
  - **|Imbalance| < 0.1**: Сбалансированный стакан
- **Практика**:
  - UP Imbalance > +0.3 → Рынок ожидает рост BTC → покупай UP
  - DOWN Imbalance > +0.3 → Рынок ожидает падение → покупай DOWN
  - Резкое изменение Imbalance — опережающий индикатор движения цены

---

### Строка SPREAD

```
SPREAD    │ UP: X.XXX │ DN: X.XXX  (ask-bid, taker cost)
```

### `up_spread_str` / `down_spread_str` — Спред (разница ask-bid)
- **Источник**: `up_asks[0][0] - up_bids[0][0]`
- **Единица**: Центы (0.01 = 1 цент)
- **Торговый контекст**:
  - **Spread < 0.02**: Ликвидный рынок, можно торговать market orders
  - **Spread 0.02-0.05**: Нормальная ликвидность
  - **Spread > 0.05**: Низкая ликвидность, используй лимитные ордера
  - **Spread > 0.10**: Критически низкая ликвидность, избегай входа
- **Практика**:
  - Спред расширяется к концу 15-минутного периода
  - Спред сужается после крупных сделок (маркет-мейкеры)
  - Широкий спред = высокая неопределённость

---

### Строка MICROPRICE

```
MICROPRICE│ UP: X.XXX │ DN: X.XXX  (weighted mid)
```

### `up_micro_str` / `down_micro_str` — Микроцена (взвешенная середина)
- **Источник**: `calculate_microprice(bids, asks)`
- **Единица**: Цена контракта (0-1)
- **Расчёт**:
  ```python
  microprice = (ask_price × bid_size + bid_price × ask_size) / (bid_size + ask_size)
  ```
- **Торговый контекст**:
  - Более точная оценка "справедливой" цены, чем простая середина
  - Microprice > Mid → покупательское давление
  - Microprice < Mid → давление продавцов
- **Практика**:
  - Если Microprice UP растёт → ожидай рост цены UP контракта
  - Сравнивай с текущим best ask — если Microprice близка к ask, скоро пробой вверх

---

### Строка OB SLOPE

```
OB SLOPE  │ UP: Bid:X.XX Ask:X.XX │ DN: Bid:X.XX Ask:X.XX  (>0.6=wall)
```

### `up_bid_slope_str`, `up_ask_slope_str`, etc. — Наклон стакана
- **Источник**: `calculate_orderbook_slope(orders, 5)`
- **Единица**: Безразмерный коэффициент (0-1)
- **Расчёт**:
  ```python
  slope = top2_depth / top5_depth
  ```
- **Торговый контекст**:
  - **Slope > 0.6**: "Стена" — ликвидность сконцентрирована на лучших уровнях
  - **Slope < 0.4**: Распределённая ликвидность — глубокий стакан
  - **Slope ≈ 0.5**: Нормальное распределение
- **Практика**:
  - High Bid Slope + Low Ask Slope → Сильная поддержка, слабое сопротивление → BULLISH
  - Low Bid Slope + High Ask Slope → Слабая поддержка, сильное сопротивление → BEARISH
  - "Стена" может быть пробита или снята — следи за Eat-Flow

---

### Строки EAT-FLOW

```
EAT-FLOW/s│ UP: Bid:±XX.X Ask:±XX.X
          │ DN: Bid:±XX.X Ask:±XX.X  (negative=eaten)
```

### `up_bid_eat_str`, `up_ask_eat_str`, etc. — Скорость "поедания" ликвидности
- **Источник**: `calculate_eat_flow(depth_history, 5.0)`
- **Единица**: Контракты в секунду ($/s)
- **Расчёт**:
  ```python
  eat_flow = (depth_now - depth_5s_ago) / 5.0
  ```
- **Торговый контекст**:
  - **Eat-Flow < -50**: Биды/аски активно съедаются — агрессивные тейкеры
  - **Eat-Flow > +50**: Ликвидность добавляется — маркет-мейкеры
  - **|Eat-Flow| < 10**: Стабильный стакан
- **Практика**:
  - UP Bid Eat-Flow << 0 → Кто-то агрессивно покупает UP → СИГНАЛ UP
  - UP Ask Eat-Flow << 0 → Кто-то агрессивно продаёт UP → СИГНАЛ DOWN
  - Комбинируй с Imbalance: если Bid Eat-Flow негативный, но Imbalance растёт → маркет-мейкер восполняет ликвидность

---

## Секция POLYMARKET ORDERBOOK

```
POLYMARKET ORDERBOOK
────────────────────
UP │ BIDS:
  0.52→1500
  0.51→800
  ...
UP │ ASKS:
  0.53→1200
  0.54→600
  ...
```

### Структура стакана
- **Формат**: `цена→размер`
- **Bids**: Ордера на покупку, сортировка DESC (лучший бид сверху)
- **Asks**: Ордера на продажу, сортировка ASC (лучший аск сверху)
- **Размер**: В контрактах (1 контракт = $1 при выигрыше)

### Интерпретация
- **Толстые биды, тонкие аски**: Покупательское давление
- **Тонкие биды, толстые аски**: Давление продавцов
- **Большой ордер на одном уровне**: "Стена" — потенциальный support/resistance

---

## Секция DEPTH & ARBITRAGE

```
DEPTH & ARBITRAGE
────────────────────
UP│Bid:1500 Ask:1200
DN│Bid:1800 Ask:900

ARBS (UP+DN BID):
L1:0.980 +0.020
L2:0.975 +0.025
...
```

### Depth Metrics
- **Bid/Ask depth**: Суммарный объём на топ-5 уровнях
- **Торговый контекст**:
  - Большая глубина → ликвидный рынок
  - Асимметрия (Bid >> Ask) → направленное давление

### Arbitrage Calculation
- **Источник**: `bid_level_sum = up_bid_price + down_bid_price`
- **Edge**: `1.0 - bid_level_sum`
- **Торговый контекст**:
  - **Edge > 0**: Арбитражная возможность! Можно продать оба контракта и заработать edge
  - **Edge ≈ 0**: Рынок эффективен
  - **Edge < 0**: "Переплата" за ликвидность (нормально для prediction markets)

### Пример арбитража
```
UP Bid: 0.52
DOWN Bid: 0.47
Sum: 0.99
Edge: +0.01 (1%)

Действие: Продать UP за 0.52 + Продать DOWN за 0.47 = получить 0.99
Гарантированная прибыль: 0.99 - 1.00 × (комиссия) = ~1% минус комиссии
```

---

## Практические торговые сигналы

### Сигнал 1: Momentum Breakout
```
Условия:
- Ret1s×100 > 0.10
- Volume Spike > 3.0
- UP Imbalance > +0.2

Действие: Купить UP по market
```

### Сигнал 2: Fade Extreme Move
```
Условия:
- Ret5s×100 > 0.30 (сильный рост)
- Volume Spike снижается (< 1.5)
- DOWN Imbalance начинает расти

Действие: Купить DOWN (fade the move)
```

### Сигнал 3: Orderbook Pressure
```
Условия:
- UP Bid Eat-Flow < -100 (биды съедаются)
- UP Ask Slope > 0.7 (стена на аске)
- Spread сужается

Действие: Ждать пробоя или отскока от стены
```

### Сигнал 4: Arbitrage
```
Условия:
- L1 Edge > 0.02 (2%+)
- Достаточная глубина на обоих рынках

Действие: Продать UP + DOWN по лучшим бидам
```

---

## Временные фазы 15-минутного рынка

### Фаза 1: Открытие (0-3 мин)
- **Характеристики**: Высокая волатильность, широкие спреды
- **Стратегия**: Ждать стабилизации или торговать только при сильных сигналах

### Фаза 2: Формирование (3-10 мин)
- **Характеристики**: Спреды сужаются, тренд определяется
- **Стратегия**: Основная фаза для входа, следовать за momentum

### Фаза 3: Развязка (10-14 мин)
- **Характеристики**: Цены сходятся к 0 или 1, волатильность падает
- **Стратегия**: Фиксация прибыли, избегать новых позиций

### Фаза 4: Финал (последние 60 сек)
- **Характеристики**: Ликвидность минимальна, спреды максимальны
- **Стратегия**: Только экстренный выход, не входить

---

## Чек-лист для торговли

### Перед входом:
- [ ] Time left > 120s?
- [ ] Spread < 0.05?
- [ ] Imbalance соответствует направлению?
- [ ] Нет противоречий между Ret1s и Ret5s?
- [ ] Volume Spike подтверждает движение?

### Мониторинг позиции:
- [ ] Eat-Flow не разворачивается?
- [ ] Slope не показывает формирование стены против позиции?
- [ ] P/VWAP не разворачивается?

### Выход:
- [ ] Time left < 60s → выходить
- [ ] Imbalance развернулся против позиции?
- [ ] Spread резко расширился?
